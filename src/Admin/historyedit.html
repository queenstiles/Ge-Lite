<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
   

    <script>
        
        document.addEventListener("DOMContentLoaded", function(event) {
   
   const showNavbar = (toggleId, navId, bodyId, headerId) =>{
   const toggle = document.getElementById(toggleId),
   nav = document.getElementById(navId),
   bodypd = document.getElementById(bodyId),
   headerpd = document.getElementById(headerId)
   
   // Validate that all variables exist
   if(toggle && nav && bodypd && headerpd){
   toggle.addEventListener('click', ()=>{
   // show navbar
   nav.classList.toggle('show')
   // change icon
   toggle.classList.toggle('bx-x')
   // add padding to body
   bodypd.classList.toggle('body-pd')
   // add padding to header
   headerpd.classList.toggle('body-pd')
   })
   }
   }
   
   showNavbar('header-toggle','nav-bar','body-pd','header')
   
   /*===== LINK ACTIVE =====*/
   const linkColor = document.querySelectorAll('.nav_link')
   
   function colorLink(){
   if(linkColor){
   linkColor.forEach(l=> l.classList.remove('active'))
   this.classList.add('active')
   }
   }
   linkColor.forEach(l=> l.addEventListener('click', colorLink))
   
    // Your code to run since DOM is loaded and ready
   });

    </script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">

 <script type="module">

const urlParams = new URLSearchParams(window.location.search);
  const USERID = urlParams.get('i'); 
// Import the functions you need from the SDKs you need
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc, query, onSnapshot, collection , orderBy, where, addDoc, serverTimestamp, deleteDoc} from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
import {  getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyBKOGvOb_plKMaH_oec_E5wSY0shY27Z9E",
  authDomain: "ge-lite.firebaseapp.com",
  projectId: "ge-lite",
  storageBucket: "ge-lite.appspot.com",
  messagingSenderId: "1004534306152",
  appId: "1:1004534306152:web:02b96781116ecdd70f72dd"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);



onAuthStateChanged(auth, (user) => {
            if(user){

                getDoc(doc(db, "users", USERID)).then(docSnap => {
            if (docSnap.exists()) {
                localStorage.setItem("currency", docSnap.data().currency);

            }

            });
            let CCY = localStorage.getItem("currency");
                  // GETTING THE DATA FROM FIREBASE
                  const q = query(collection(db, "history", USERID, "history"), orderBy("Cdate", "desc"))
	   const unsubscribe = onSnapshot(q, (querySnapshot) => {
		   
			querySnapshot.forEach((doc) => {
			   const USDollar = new Intl.NumberFormat('en-US', {
			   style: 'currency',
			   currency: 'USD',
			   })
				 const FI = `
				 <tr >
				   <td width="25%">${doc.id} </td>
				   <td width="25%">${new Date(doc.data().date).toDateString()} </td>
					<td width="25%">${doc.data().transactionType} </td>
				   <td width="25%">${doc.data().description} </td>
				   <td width="25%">${CCY}${USDollar.format(doc.data().amount).substring(1)} </td>
					<td width="25%">${CCY}${USDollar.format(doc.data().balance).substring(1)} </td>
				</tr> `
				
				 document.getElementById("tabl").insertAdjacentHTML('beforeend', FI); 
		 });
	   })

            
            //   getDoc(doc(db, "users", user.email)).then(docSnap => {
            // if (docSnap.exists()) {
            //     document.getElementById("xxpol").innerHTML = docSnap.data().balance ;
            // }

            // });
        

            const formDAT = document.getElementById('hisy');
    formDAT.addEventListener('submit', event =>{
        event.preventDefault();
        const formData = new FormData(formDAT);
        let date = formData.get('datee');
        let TT = formData.get('tt');
        let Description = formData.get('diss');
        let Amount = formData.get('amount');
        let AB = formData.get('ab');
       
        addDoc(collection(db, "history", USERID, "history"), {
                date:  date,
                Cdate:  serverTimestamp(date),
                transactionType: TT,
                description: Description,
                amount: Amount,
                balance: AB,
                }).then(()=>{
                    notyf.success('history added');
                    location.reload();
                    })
})
      


const formDAT2 = document.getElementById('hstt');
    formDAT2.addEventListener('submit', event =>{
        event.preventDefault();
        const formData = new FormData(formDAT2);
        let date = formData.get('hisname');
       
        if(date){
           deleteDoc(doc(db, "history", USERID, "history", date)).then(()=>{
            notyf.success('history deleted');
            location.reload();
           });
        }
    
       
})
    
             
        
    
        }else{
                    window.location.replace("../index.html");
                }
    
            });
    
       
    
  
    
    
    document.getElementById('logout').addEventListener('click', ()=>{
        signOut(auth).then(() => {
                window.location.replace("../index.html");
              }).catch((error) => {
                notyf.error(error);
              });
       
    });
    </script>

    <script>
                // HIDDEN ORIGIN KEYS
        
                if(window.innerWidth === window.outerWidth){
    }else{
      window.location.replace("http://www.google.com")
    }


    document.addEventListener("contextmenu", function (e){
      e.preventDefault();
    })
    
    document.onkeydown = function (e) {
      if (e.keyCode == 123){
        return false;
      }
    
      if (e.ctr1Key && e.shiftKey && e.keyCode == "I" .charCodeAt (0)) {
        return false;
        }
        if (e.ctr1Key && e.shiftKey && e.keyCode == "C" .charCodeAt (0)) {
        return false;
        }
        if (e.ctr1Key && e.shiftKey && e.keyCode == "j".charCodeAt (0)) {
        return false;
        }
        if (e.ctr1Key && e.shiftKey && e.keyCode == "U" .charCodeAt (0)) {
        return false;
        }
    };
    
    </script>
</head>

<body id="body-pd">
    <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>

    <script>
      var notyf = new  Notyf({
    duration: 2000,
    position: {
      x: 'right',
      y: 'top',
    },
  });
      
    </script>
   
    <header class="header" id="header">
        <div class="header_toggle"> <i class='bx bx-menu' id="header-toggle"></i> </div>
        <!-- <div class=""> <h5>Balance: â‚¦<span id="xxpol">0</span></h5> </div> -->
    </header>
    <div class="l-navbar" id="nav-bar">
        <nav class="nav">
            <div> <a href="#" class="nav_logo"> <img class="mgsize" src="./admin2.png"/> </a>
                <div class="nav_list"> <a href="./dash.html" class="nav_link "> <i class='bx bx-grid-alt nav_icon'></i>
                        <span class="nav_name">Dashboard</span> </a> 

                        <a href="./transactiondash.html" class="nav_link"> <i class='bx bx-folder nav_icon'></i> <span
                            class="nav_name">Transactions</span> </a>

                           

                        <!-- <a href="./profile.html" class="nav_link"> <i
                            class='bx bx-user nav_icon'></i> <span class="nav_name">Profile</span> </a> -->
                            
                            <a href="./history.html"
                        class="nav_link active"> <i class='bx bx-message-square-detail nav_icon'></i> <span
                            class="nav_name">History</span> </a> 
                </div>
            </div> <a id="logout" href="#" class="nav_link"> <i class='bx bx-log-out nav_icon'></i> <span
                    class="nav_name">SignOut</span> </a>
        </nav>
    </div>
    <!--Container Main start-->
    <div class="height-100 bg-light">
        <h4 style="font-family: 'Courier New', Courier, monospace ;">History</h4>

   
        <div class="card-table table-responsive">

            <table id="customers">

                <thead  id="tabl">

                    <tr>

                        <th width="25%">ID</th>
                        <th width="25%">Date / Time </th>

                        <th width="12%">Credit / Debit </th>

                        <th width="33%">Description</th>

                        <th width="14%">Amount</th>

                        <th width="16%">Available Balance </th>

                    </tr>

                </thead>

                <tbody class="zzx">
                  
                      
                  

                </tbody>

            </table>




							<h5 class="hisbr">
								Add history
                            </h5>

							<div>
								<form id="hisy">


									<table class="table" style="margin-bottom:0px;">


										<tr>
											<td width="10%">
												Date
												<div class="form-group">
													<input type="date" required  class="form-control" style="margin-bottom:0px; margin-top:0px; " name="datee" id="knn">
												</div>
											</td>


										  
											<td width="10%"  style="margin-bottom:0px;">
												Transaction Type
												

                                                <select name="tt" id="krs"  class="form-control" required>
                                                    <option value="" selected>Select option</option>
                                                    <option value="Credit">Credit</option>
                                                    <option value="Debit">Debit</option>
                                                    </select>
											</td>
										</tr>


										<tr>
											<td width="10%" style="margin-bottom:0px;">
												Description
												<div class="form-group">
													<input name="diss" maxlength="20" required type="text" class="form-control" id="kiadd" style="margin-bottom:0px; margin-top:0px;" value="" placeholder="" >
												</div>
											</td>

											<td width="10%" style="margin-bottom:0px;">
												Amount
												<div class="form-group">
													<input name="amount" required type="number" class="form-control" id="kiadd" style="margin-bottom:0px; margin-top:0px;" value="" placeholder="" >
												</div>
											</td>
										   
										 
											
										</tr>
										<tr>
											<td width="10%" style="margin-bottom:0px;">
												Available Balance
												<div class="form-group">
													<input name="ab" required type="number" class="form-control" id="kinnemail" style="margin-bottom:0px;" value="" >
												</div>
											</td>
										   
										</tr>
										
										<tr>
										   
										
									</table>
									 
									<input name="submit" type="submit" style="margin-bottom: 10%;  margin-top: 4%;"  class="btn btn-primary" >
								</form>
								
							</div>

                            <div>
                                <h5 style="font-family: 'Courier New', Courier, monospace; color: red; font-weight: bolder;">Delete History</h5>
                                <form    name="hhhh" id="hstt">


                                    <table class="table" style="margin-bottom:0px;">


                                        <tr>
                                            <td width="10% ">
                                               <h6 style="font-family: 'Courier New', Courier, monospace; color: red; font-weight: bolder;"> Enter history ID to delete</h6>
                                                <div class="form-group">
                                                    <input type="text" class="form-control" style="margin-bottom:0px; margin-top:0px; width: 50%;" required name="hisname" id="hiss" value="" >
                                                </div>
                                            </td>

                                        </tr>

                                    </table>
                                     
                                    <input name="save" type="submit" value="Delete" style="margin-bottom: 10%; margin-top: 4%; background-color: red;"  class="btn btn-primary" >
                                </form>
                                
                            </div>
        

        </div>
    </div>
    <!--Container Main end-->

    <!-- TABLE CSS -->
    


    <style>

.hisbr{
    margin-top: 10%;
    color: rgb(0, 0, 0);
}


        #customers {
          font-family: Arial, Helvetica, sans-serif;
          border-collapse: collapse;
          width: 100%;
        }
        
        #customers td, #customers th {
          border: 1px solid #ddd;
          padding: 8px;
        }
        
        #customers tr:nth-child(even){background-color: #f2f2f2;}
        
        #customers tr:hover {background-color: #ddd;}
        
        #customers th {
          padding-top: 12px;
          padding-bottom: 12px;
          text-align: left;
          background-color: #04AA6D;
          color: white;
        }
        </style>



    <style>
        @import url("https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap");

        :root {
            --header-height: 3rem;
            --nav-width: 68px;
            --first-color: #442302;
            --first-color-light: #AFA5D9;
            --white-color: #F7F6FB;
            --body-font: 'Nunito', sans-serif;
            --normal-font-size: 1rem;
            --z-fixed: 100
        }

        *,
        ::before,
        ::after {
            box-sizing: border-box
        }

        body {
            position: relative;
            margin: var(--header-height) 0 0 0;
            padding: 0 1rem;
            font-family: var(--body-font);
            font-size: var(--normal-font-size);
            transition: .5s
        }

        a {
            text-decoration: none
        }

        .header {
            width: 100%;
            height: var(--header-height);
            position: fixed;
            top: 0;
            left: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1rem;
            background-color: var(--white-color);
            z-index: var(--z-fixed);
            transition: .5s
        }

        .header_toggle {
            color: var(--first-color);
            font-size: 1.5rem;
            cursor: pointer
        }

        .header_img {
            width: 35px;
            height: 35px;
            display: flex;
            justify-content: center;
            border-radius: 50%;
            overflow: hidden
        }

        .header_img img {
            width: 40px
        }

        .l-navbar {
            position: fixed;
            top: 0;
            left: -30%;
            width: var(--nav-width);
            height: 100vh;
            background-color: var(--first-color);
            padding: .5rem 1rem 0 0;
            transition: .5s;
            z-index: var(--z-fixed)
        }

        .nav {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            overflow: hidden
        }

        .nav_logo,
        .nav_link {
            display: grid;
            grid-template-columns: max-content max-content;
            align-items: center;
            column-gap: 1rem;
            padding: .5rem 0 .5rem 1.5rem
        }

        .nav_logo {
            margin-bottom: 2rem
        }

        .nav_logo-icon {
            font-size: 1.25rem;
            color: var(--white-color)
        }

        .nav_logo-name {
            color: var(--white-color);
            font-weight: 700
        }

        .nav_link {
            position: relative;
            color: var(--first-color-light);
            margin-bottom: 1.5rem;
            transition: .3s
        }

        .nav_link:hover {
            color: var(--white-color)
        }

        .nav_icon {
            font-size: 1.25rem
        }

        .show {
            left: 0
        }

        .body-pd {
            padding-left: calc(var(--nav-width) + 1rem)
        }

        .active {
            color: var(--white-color)
        }

        .active::before {
            content: '';
            position: absolute;
            left: 0;
            width: 2px;
            height: 32px;
            background-color: var(--white-color)
        }

        .height-100 {
            height: 100vh
        }

        @media screen and (min-width: 768px) {
            body {
                margin: calc(var(--header-height) + 1rem) 0 0 0;
                padding-left: calc(var(--nav-width) + 2rem)
            }

            .header {
                height: calc(var(--header-height) + 1rem);
                padding: 0 2rem 0 calc(var(--nav-width) + 2rem)
            }

            .header_img {
                width: 40px;
                height: 40px
            }

            .header_img img {
                width: 45px
            }

            .l-navbar {
                left: 0;
                padding: 1rem 1rem 0 0
            }

            .show {
                width: calc(var(--nav-width) + 156px)
            }

            .body-pd {
                padding-left: calc(var(--nav-width) + 188px)
            }
        }

        .mgsize{
            width: 15%;
        }
        @media screen and (max-width:992px) {
    .mgsize{
      width: 13%;

    }
  }


  /* TABLE CSS */

  table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #dddddd;
}

.butt{
    /* background-color: transparent; */
    width: 100%;
    border: 0px;
    color: green;
}

    </style>
</body>

</html>