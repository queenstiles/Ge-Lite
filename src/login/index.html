<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <script src="code.js" defer></script>
    <title>Login Access</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">
    <link rel="icon" href=".././logo.ico" type="image/x-icon">

    <script type="module">

      
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
      import { getFirestore, doc, setDoc, getDoc} from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
      import {  getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries
    
      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBKOGvOb_plKMaH_oec_E5wSY0shY27Z9E",
  authDomain: "ge-lite.firebaseapp.com",
  projectId: "ge-lite",
  storageBucket: "ge-lite.appspot.com",
  messagingSenderId: "1004534306152",
  appId: "1:1004534306152:web:02b96781116ecdd70f72dd"
      };
    
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);


      onAuthStateChanged(auth, (user) => {
      if(user){
        if (user.email === 'support@gelite.online') {
    // window.location.href = "../../Admin/dash.html";
    // ...
  } else {
    // window.location.href = "../../dashboard/index.html";
  }
      }
 
});

  const formDAT = document.getElementById('fms');

  formDAT.addEventListener('submit', async(event) =>{
     event.preventDefault();

     const formData = new FormData(formDAT);
    let accountNumber = formData.get('accountNumber');
    let email = formData.get('email');
    let password = formData.get('password');

    const docRef = doc(db, "users", email);
    const docSnap = await getDoc(docRef);

if (docSnap.exists()) {
   document.getElementById('emm').innerHTML = docSnap.data().email;
  if(docSnap.data().accountNumber == accountNumber){

    if(docSnap.data().password == password){

      // SENDING OTP CODE

      let OTP = Math.floor(1000 + Math.random() * 9000);
      let formData2 = {
                email: document.getElementById('email').value,
                OTP: OTP,
            }

			const options = {
                method: 'POST',
                
                headers: {
                    'Content-type' : 'application/json'
                },
                body: JSON.stringify(formData2),
            }
    
          const respones = await  fetch('/login/index.html', options);
    
           respones.json().then((dd)=>{
			// notyf.success('you are loged-in');
            //    alert("message receieved successfully!!!")
              //  console.log(dd);
          })

      //CHANGING VIEWS
      //CHANGING VIEWS
      //CHANGING VIEWS
      //CHANGING VIEWS

      notyf.success(`OTP was sent to ${docSnap.data().email}`);
      const ST4 = document.getElementById('loginbody')
      ST4.classList.add("fombody2");
      const ST5 = document.getElementById('otpbody')
      ST5.classList.remove("bodys");
      ///ACTIVATING COUNTER
      let counter = 39
     let cc = setInterval(()=>{
          counter--
          document.getElementById('tt').innerHTML = counter;
          if(counter == 0){
          const ST1 = document.getElementById('bbtt')
          ST1.classList.replace("hiddd", "showw");

          const ST2 = document.getElementById('tt')
          ST2.classList.add("ttms");
              clearInterval(cc)
          }
      },1000)

      document.getElementById('rss').addEventListener('click', ()=>{
        const ST1 = document.getElementById('bbtt')
          ST1.classList.replace("showw", "hiddd");
          const ST2 = document.getElementById('tt')
          ST2.classList.remove("ttms");
              
          let counter = 39
     let cc = setInterval(()=>{
          counter--
          document.getElementById('tt').innerHTML = counter;
          if(counter == 0){
          const ST1 = document.getElementById('bbtt')
          ST1.classList.replace("hiddd", "showw");

          const ST2 = document.getElementById('tt')
          ST2.classList.add("ttms");
              clearInterval(cc)
          }
      },1000)

      })

      ///// RESEND OTP
      document.getElementById('rss').addEventListener('click', async()=>{
      let formData2 = {
                email: docSnap.data().email,
                OTP: OTP,
            }

			const options = {
                method: 'POST',
                
                headers: {
                    'Content-type' : 'application/json'
                },
                body: JSON.stringify(formData2),
            }
    
          const respones = await  fetch('/login/index.html', options);
    
           respones.json().then((dd)=>{
			notyf.success('OTP was sent');
            //    alert("message receieved successfully!!!")
              //  console.log(dd);
          })
      })

      //SUBMIT OTP
     
      document.getElementById('submit2').addEventListener('click', ()=>{
        if(localStorage.getItem("otp") == OTP){
          notyf.success('logging in please wait');
          signInWithEmailAndPassword(auth, docSnap.data().email, docSnap.data().password)
          .then((userCredential) => {
            // Signed in 
            if(userCredential){
              window.location.href="../dashboard/index.html"
            }
           
            const user = userCredential.user;
          
            // ...
          })
          .catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
            notyf.error(error.message);
          });
          
        }else{
          notyf.error('incorrect OTP');
        }
      })
      


    }else{
      notyf.error('Incorrect password');
    }
    
  }else{
    notyf.error('Incorrect account ID');
  }
  
} else {
  // docSnap.data() will be undefined in this case

  notyf.error('Incorrect email address');
}


      

//     if(formData){
// signInWithEmailAndPassword(auth, email, password)
//   .then((userCredential) => {
//     window.location.href = "./login.html";
//   })
//   .catch((error) => {
//     const errorCode = error.code;
//     const errorMessage = error.message;
//     notyf.error(errorCode);
//   });
//     }else{
//       notyf.error('something went wrong');
//     }


  });





</script>

  </head>
  <body>
    <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>

    <script>
      var notyf = new  Notyf({
    duration: 4000,
    position: {
      x: 'right',
      y: 'top',
    },
  });
      
    </script>
  
  <div id="loginbody" class="fombody">
   <h1 style="text-align: center; font-family: 'Courier New', Courier, monospace;">Login</h1>
   <label style="text-align: center; padding: 3%;">Enter your existing account credential to continue</label>
   <form id="fms" class="fmms">
    
   <div style="margin-top: 5%;">
    <label>Account ID:</label>
    <input  class="inpp" type="number" id="accountNumber" required name="accountNumber" placeholder="Ex: 618xxxxxxx" />
   </div>

   <div style="margin-top: 5%;">
    <label>Email:</label>
    <input  class="inpp" type="email" id="email" required name="email" placeholder="Your registered email address" />
   </div>

   <div style="margin-top: 5%;">
    <label>Password:</label>
    <input  class="inpp" type="password" required id="password" name="password" placeholder="Enter Password" />
   </div>

   <div style="margin-top: 5%;">
    <a href="forgottenpassword.html">Forgot Password?</a>
   </div>

   <div style="margin-top: 5%;">
    <input  class="inpp btcolor" type="submit" value="Next" />
   </div>
    
   <div style="margin-top: 5%;">
    <p6 style="font-size: small;">don't have an account <a href="../register/index.html"><strong>register</strong></a></p6>
   </div>
   </form>
   
  </div>

  <style>
    .fombody{
      background-color: rgb(243, 243, 243);
      width: 40%;
      font-family: 'Courier New', Courier, monospace;
      color: rgb(14, 45, 14);
      font-weight: bolder;
    }
    @media screen and (max-width:992px) {
      .fombody {
        width: 95%;
    }}
.fombody2{
  display: none;
}
    .fmms{
      background-color: rgba(190, 176, 151, 0.221);
      padding: 5%;
      margin:5%;
    }

    .inpp{
      padding: 3%;
      font-size: 110%;
      font-family: 'Courier New', Courier, monospace;
    }

    .btcolor{
      background-color: rgba(4, 101, 4, 0.964);
      color: white;
    }
    .btcolor:hover{
      background-color: green;
    }

  

.container {
  width: 28em;
  background-color: #ffffff;
  padding: 4em 2em;
  position: absolute;
  transform: translate(-50%, -50%);
  top: 50%;
  left: 50%;
  border-radius: 0.8em;
  box-shadow: 0 45px 60px rgba(30, 22, 1, 0.3);
}
@media screen and (max-width:992px) {
      .container {
        width: 95%;
    }}
.inputfield {
  width: 100%;
  display: flex;
  justify-content: space-around;
}
.input {
  height: 3em;
  width: 3em;
  border: 2px solid #dad9df;
  outline: none;
  text-align: center;
  font-size: 1.5em;
  border-radius: 0.3em;
  background-color: #ffffff;
  outline: none;
  /*Hide number field arrows*/
  -moz-appearance: textfield;
}
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
#submit2 {
  background-color: #0a790d;
  border: none;
  outline: none;
  font-size: 1.2em;
  padding: 0.8em 2em;
  color: #ffffff;
  border-radius: 0.1em;
  margin: 1em auto 0 auto;
  cursor: pointer;
}
.show {
  display: block;
}
.hide {
  display: none;
}
.input:disabled {
  color: #89888b;
}
.input:focus {
  border: 3px solid #ffb800;
}

.logosvg{
  display: flex;
  align-items: center;
  justify-content: center;
margin-bottom: 5%;
}
.showw{
  display: flex;
  align-items: center;
  justify-content: center;
}
.hiddd{
  display: none;
}

.ttms{
  display: none;
}

.bodys{
  display: none;
}
  </style>

  <!-- OTP SECTION  -->

  <div id="otpbody" class="bodys">
    <div class="container">
      <div class="logosvg">
        <svg xmlns="http://www.w3.org/2000/svg" width="46" height="56" fill="currentColor" class="bi bi-shield-lock-fill" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M8 0c-.69 0-1.843.265-2.928.56-1.11.3-2.229.655-2.887.87a1.54 1.54 0 0 0-1.044 1.262c-.596 4.477.787 7.795 2.465 9.99a11.777 11.777 0 0 0 2.517 2.453c.386.273.744.482 1.048.625.28.132.581.24.829.24s.548-.108.829-.24a7.159 7.159 0 0 0 1.048-.625 11.775 11.775 0 0 0 2.517-2.453c1.678-2.195 3.061-5.513 2.465-9.99a1.541 1.541 0 0 0-1.044-1.263 62.467 62.467 0 0 0-2.887-.87C9.843.266 8.69 0 8 0zm0 5a1.5 1.5 0 0 1 .5 2.915l.385 1.99a.5.5 0 0 1-.491.595h-.788a.5.5 0 0 1-.49-.595l.384-1.99A1.5 1.5 0 0 1 8 5z"/>
        </svg>
      </div>
     <h3 style=" text-align: center; font-weight: lighter; font-family: 'Courier New', Courier, monospace;">Enter OTP  that was sent to <span id="emm"></span></h3>
      <div class="inputfield">
        <input type="number" maxlength="1" class="input" style="color: black;" disabled />
        <input type="number" maxlength="1" class="input" style="color: black;" disabled />
        <input type="number" maxlength="1" class="input" style="color: black;" disabled />
        <input type="number" maxlength="1" class="input" style="color: black;" disabled />
      </div>
      <div>
        <div id="ttm" class="" style="margin-top: 10%;">
          <p style="text-align: center;"><span id="tt">39</span></p>

        </div>
          <div id="bbtt" class="hiddd">
            <a id="rss" style="color: blue; ">Resend OTP</a>
          </div>
       
      </div>
      <button class="hide" id="submit2" >Login</button>
      
    </div>

    <!-- Script -->
    <script>

      //Initial references
const input = document.querySelectorAll(".input");
const inputField = document.querySelector(".inputfield");
const submitButton = document.getElementById("submit2");
let inputCount = 0,
  finalInput = "";

//Update input
const updateInputConfig = (element, disabledStatus) => {
  element.disabled = disabledStatus;
  if (!disabledStatus) {
    element.focus();
  } else {
    element.blur();
  }
};

input.forEach((element) => {
  element.addEventListener("keyup", (e) => {
    e.target.value = e.target.value.replace(/[^0-9]/g, "");
    let { value } = e.target;

    if (value.length == 1) {
      updateInputConfig(e.target, true);
      if (inputCount <= 3 && e.key != "Backspace") {
        finalInput += value;
        if (inputCount < 3) {
          updateInputConfig(e.target.nextElementSibling, false);
        }
      }
      inputCount += 1;
    } else if (value.length == 0 && e.key == "Backspace") {
      finalInput = finalInput.substring(0, finalInput.length - 1);
      if (inputCount == 0) {
        updateInputConfig(e.target, false);
        return false;
      }
      updateInputConfig(e.target, true);
      e.target.previousElementSibling.value = "";
      updateInputConfig(e.target.previousElementSibling, false);
      inputCount -= 1;
    } else if (value.length > 1) {
      e.target.value = value.split("")[0];
    }
    submitButton.classList.add("hide");
  });
});

window.addEventListener("keyup", (e) => {
  if (inputCount > 3) {
    submitButton.classList.remove("hide");
    submitButton.classList.add("show");
    localStorage.setItem("otp", finalInput);
    if (e.key == "Backspace") {
      finalInput = finalInput.substring(0, finalInput.length - 1);
      updateInputConfig(inputField.lastElementChild, false);
      inputField.lastElementChild.value = "";
      inputCount -= 1;
      submitButton.classList.add("hide");
    }
  }
});

// const validateOTP = () => {
//   alert("Success");
// };

//Start
const startInput = () => {
  inputCount = 0;
  finalInput = "";
  input.forEach((element) => {
    element.value = "";
  });
  updateInputConfig(inputField.firstElementChild, false);
};

window.onload = startInput();

    </script>


<script src="//code.tidio.co/kpou8nsvqeo0uqbbggpj5xejhldngu4b.js" async></script>
  </body>


</html>